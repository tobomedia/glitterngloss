const PDFDocument = require("pdfkit");
const logo = require("../public/gnglogo.png");

exports.handler = async (event, context) => {
  const subject = event.queryStringParameters.name || "World";

  const pdfBuffer = await new Promise((resolve) => {
    const doc = new PDFDocument({ size: [595, 280] });

    doc.text(`Hello ${subject}`, 100, 100);
    doc
      .path(
        "M136.615,99.46 C133.531,98.185 132.041,102.445 131.55,104.424 C127.476,130.294 128.581,157.184 128.992,183.414 C129.233,182.255 128.679,181.159 128.92,179.999 C130.464,174.196 131.938,168.259 133.41,162.322 C136.267,149.635 138.982,136.682 140.27,123.63 C140.718,117.381 141.487,110.446 139.563,104.257 C138.833,102.242 138.809,100.353 136.615,99.46 Z M141.912,101.01 C143.141,103.961 143.559,108.002 143.709,111.185 C144.154,117.818 143.375,124.415 142.526,130.878 C141.615,137.547 140.427,144.019 139.034,150.43 C136.569,162.562 132.561,174.642 129.088,187.14 C129.39,193.506 130.393,206.025 132.461,207.326 C134.805,208.825 137.293,205.438 138.533,203.576 C144.056,194.277 144.728,183.616 146.871,172.168 C147.058,171.553 149.012,171.732 148.896,172.48 C146.628,184.337 146,196.694 139.684,206.757 C138.051,209.173 134.528,211.206 131.453,210.268 C127.967,209.206 125.865,201.395 124.797,196.813 C120.73,173.39 122.004,149.354 123.358,125.791 C123.967,117.911 123.639,109.824 127.385,102.675 C128.679,100.268 131.899,96.024 134.869,95.472 C137.98,95.187 140.896,98.46 141.912,101.01 L141.912,101.01 Z"
      )
      .fill("grey");
    doc
      .path(
        "M599.231,177.842 C599.685,177.535 607.406,171.024 603.186,170.941 C600.935,170.844 598.444,172.939 598.348,175.191 C598.369,176.345 598.7,177.135 599.231,177.842 Z M620.375,177.19 C616.14,179.557 606.427,182.832 601.591,181.846 C597.033,186.209 592.077,188.185 585.933,189.611 C580.917,190.68 573.207,190.323 570.933,184.653 C568.575,178.785 572.617,171.265 576.863,167.265 C583.629,160.692 594.118,157.433 603.165,160.133 C605.805,160.88 608.642,162.362 609.806,165.126 C610.473,166.707 610.37,169.775 608.499,171.958 C608.187,172.322 606.739,171.814 606.911,171.392 C607.934,169.682 608.536,167.799 607.621,165.626 C604.895,160.262 596.367,162.767 591.709,164.962 C586.008,167.713 580.633,172.072 576.356,176.55 C574.346,178.677 572.049,181.506 572.622,184.522 C573.194,187.538 576.34,188.654 578.986,188.584 C584.73,188.141 592.551,182.748 597.385,179.315 C596.63,178.353 596.131,176.168 596.308,174.932 C596.634,172.117 600.601,169.054 603.164,168.788 C605.249,168.49 606.959,170.514 607.059,172.682 C607.07,175.468 605.283,177.85 603.468,179.893 C607.857,180.371 614.259,178.459 617.959,176.202 C618.412,175.896 621.222,176.715 620.375,177.19 L620.375,177.19 Z"
      )
      .fill("grey");

    doc.image(logo);
    doc.end();

    const buffers = [];

    doc.on("data", buffers.push.bind(buffers));

    doc.on("end", () => {
      const pdfData = Buffer.concat(buffers);

      resolve(pdfData);
    });
  });

  return {
    statusCode: 200,
    headers: {
      "Content-Type": "application/pdf",
    },
    body: pdfBuffer.toString("base64"),
    isBase64Encoded: true,
  };
};
